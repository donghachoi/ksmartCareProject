<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default}">

<th:block layout:fragment="customTitle">
	<title>index</title>
		<!-- Bootstrap -->
       <link rel="stylesheet" href="/assets/lib/bootstrap/css/bootstrap.css">
       
       <!-- Font Awesome -->
       <link rel="stylesheet" href="/assets/lib/font-awesome/css/font-awesome.css">
       
       <!-- Metis core stylesheet -->
       <link rel="stylesheet" href="/assets/css/main.css">
       
       <!-- metisMenu stylesheet -->
       <link rel="stylesheet" href="/assets/lib/metismenu/metisMenu.css">
       
       <!-- onoffcanvas stylesheet -->
       <link rel="stylesheet" href="/assets/lib/onoffcanvas/onoffcanvas.css">
       
       <!-- animate.css stylesheet -->
       <link rel="stylesheet" href="/assets/lib/animate.css/animate.css">
      
       <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.12/css/dataTables.bootstrap.min.css">
       <!-- datePicker -->
       <link rel="stylesheet" type="text/css" href="https://cdn.rawgit.com/Eonasdan/bootstrap-datetimepicker/a549aa8780dbda16f6cff545aeabc3d71073911e/build/css/bootstrap-datetimepicker.css">
       <script>
           less = {
               env: "development",
               relativeUrls: false,
               rootpath: "/assets/"
           };
       </script>
		
       <link rel="stylesheet" href="/assets/css/style-switcher.css">
       <link rel="stylesheet/less" type="text/css" href="/assets/less/theme.less">
       <script src="https://cdnjs.cloudflare.com/ajax/libs/less.js/2.7.1/less.js"></script>

       </style>
</th:block>
<th:block layout:fragment="customContents">
<body class="  ">
	<div class="bg-dark dk" id="wrap">
		<div id="top">
			<header class="head">
				<div class="main-bar">
				   <h3><i class="fa fa-table"></i>&nbsp;수급자 리스트 </h3>
				</div>
				<!-- /.main-bar -->
			</header>
		<!-- /.head -->
		</div>
	<!-- /#top -->
	</div>
	<div id="content">
		<div class="outer">
			<div class="inner bg-light lter">
				<div class="row">
					<div class="col-lg-12 ui-sortable">
							<div class="box ui-sortable-handle"
								style="position: relative; left: 0px; top: 0px;">
				<header>
					<div class="icons">
						<i class="fa fa-table"></i>
					</div>
					<h5>수급자 리스트</h5>
				</header>
				<!-- 테이블 Start -->
				<div id="collapse4" class="body" >
						<div class="row">
							<div class="col-sm-12">
								<table id="dataTable" class="table table-bordered table-hover" style="font-size: 15px">
									<thead>
										<tr role="row">
											<th>수급자아이디</th>
											<th>수급자이름</th>
											<th>생년월일</th>
											<th>성별</th>
											<th>등급</th>
											<th>인정만료일</th>
										</tr>
									</thead>
									<tbody id="elderRow">
										<tr role="row" class="odd" th:each="E:${elderList}" style="cursor: pointer;">
											<td class="sorting_1" th:text="${E.elderId}"></td>
											<td th:text="${E.elderName}"></td>
											<td th:text="${E.elderBirthDate}"></td>
											<td th:text="${E.elderGender}"></td>
											<td th:text="${E.elderFinalServiceApprovalLevel}"></td>
											<td th:text="${E.longTermCareValidity}"></td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>
				<!-- 테이블 End -->
						<!-- 수급자 상세정보 Start -->
						<div class="col-lg-12 ui-sortable" >
							<div class="box ui-sortable-handle">
								<header>
									<div class="icons">
										<i class="fa fa-table"></i>
									</div>
									<h5>수급자 상세 정보</h5>
									<div class="toolbar">
										<div class="btn-group">
											<a href="#defaultTable" data-toggle="collapse"
												class="btn btn-sm btn-default minimize-box"
												id="collapsTable"> 
												<i class="fa fa-angle-up"></i>
											</a>
										</div>
									</div>
								</header>
								<div id="defaultTable" class="body collapse in" style="display : none; font-size: 15px">
									<table class="table responsive-table">
										<tbody>
											<tr>
												<th>수급자아이디</th>
												<td id="elderId"></td>
												<th>수급자명</th>
												<td id="elderName"></td>
												<th>성별</th>
												<td id="elderGender"></td>
												
											</tr>
											<tr>
												<th>최초입소일</th>
												<td id="serviceStartDate"></td>
												<th>수급현황</th>
												<td id="elderFinalServiceStatus"></td>
												<th>생년월일</th>
												<td id="elderBirthDate"></td>
											</tr>
											<tr>
												<th>본인부담률</th>
												<td id="elderCoinsurance"></td>
												<th>급여한도</th>
												<td>이번달 급여한도</td>
												<td></td>
												<td></td>
											</tr>
											<tr>
												<th>인정등급/번호</th>
												<td id="elderLevel"></td>
												<th>인정기간</th>
												<td id="elderServiceApprovalDate">
												</td>
												<th><button type="button"  
														data-toggle="modal" data-target="#myModal"
														class="btn btn-primary btn-sm">
														<span>등급인정관리</span>
													</button></th>
												<th></th>
											</tr>
											<tr>
												<th>계약만료일</th>
												<td id="serviceEndDate">
													</td>
												<th colspan="3"><button type="button"  
														data-toggle="modal" data-target="#myModal3"
														class="btn btn-primary btn-sm">
													<span>계약관리</span>
													</button></th>
												<th></th>
											</tr>
											<tr>
												<th>휴대폰</th>
												<td id= "elderPhone"></td>
												<th></th>
												<td></td>
												<td></td>
												<td></td>
											</tr>
											<tr>
												<th>주소(거주)</th>
												<td colspan="5" id="elderAdressForStay"></td>
											</tr>
											<tr>
												<th>주소(우편)</th>
												<td colspan="5" id="elderAdressForPost"></td>
											</tr>
											<tr>
												<th>주요질환</th>
												<td id="elderDisease"></td>
												<th>비고</th>
												<td colspan="3" id="elderRemarks"></td>
											</tr>
										</tbody>
									</table>
									<!-- 수급자 상태 관리 최근내역 -->
									<h3>수급자 상태 최근 관리내역</h3>
									<table class="table text-center">
									<tr class="active">
										<td><strong>낙상위험측정</strong></td>
										<td><strong>욕창위험측정</strong></td>
										<td><strong>인지기능검사</strong></td>
										<td><strong>욕구사정</strong></td>
										<td><strong>과거이력보기</strong></td>
									</tr>
									<tr>
										<td id="fallDownCheckDate"></td>
										<td id="bedsoreCheckDate"></td>
										<td id="functionCheckDate"></td>
										<td id="needsCheckDate"></td>	
										<td><button type="button"  
														data-toggle="modal" data-target="#myModal2"
														class="btn btn-primary btn-sm">
														<span class="ui-button-text">확인</span>
											</button>
										</td>
									</tr>
									</table>
								</div>
							</div>
						</div>
						<!-- 수급자 상세정보 End-->
					</div>
				</div>
			</div>
			<!-- 등급 및 인정기간 관리  Modal -->
			<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="false" style="position: absolute; padding-top: 200px">
			  <div class="modal-dialog modal-lg" style="position: absolute; margin-top: 300px; margin-left: 300px;">
			    <div class="modal-content">
			      <div class="modal-header">
			        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			        <h1 class="modal-title" id="myModalLabel">등급 및 인정기간 관리</h1>
			      </div>
			      <div class="modal-body">
						<h3>인정기간 이력</h3>
						<div class="row">
							<div id="collapse4" class="col-sm-12" style="overflow:auto; height:150px;">
								<table id="levelTable" class="table table-bordered table-condensed table-hover table-striped modal-able" >
									<thead>
										<tr>
											<th>등급</th>
											<th>인정시작</th>
											<th>인정종료</th>
											<th>인정번호</th>
											<th>진행상태</th>
											<th>진행결과</th>
											<th>삭제</th>
										</tr>
									</thead>
									<tbody id="elderServiceLevel"  style="cursor: pointer;">
									
									</tbody>
								</table>
							</div>
						</div>
						<h3>이력 등록/수정</h3>
						<div class="row">
							<div class="col-sm-12">
								<form id="level">
								<div class="form-group" style="background-color: #CCCCCC; border-radius: 2px; padding: 10px;" >
									<label>등급
										<select id="levelGrade" name="elderServiceApprovalLevel">
											<option value="">=등급=</option>
											<option value="1">1등급</option>
											<option value="2">2등급</option>
											<option value="3">3등급</option>
											<option value="4">4등급</option>
											<option value="5">5등급</option>
											<option value="0">등급외</option>
											<option value="12">인지지원</option>
										</select>
									</label>
									<div>
										<label>장기요양인정번호
											<input type="text" id="approvalNumber" maxlength="11" placeholder="L0000000000" name="elderServiceApprovalNumber">
										</label>
									</div>
									<div>
									<div>
										<label>진행상태
											<select id="approvalCategory" name="elderServiceApprovalCategory">
												<option selected value="">진행상태 선택</option> 
												<option>1최초신청(진행중)</option> 
												<option>2재신청(진행중)</option> 
												<option>3_1최초등급승인</option>
												<option>3_2최초등급미승인</option>
												<option>4_1재신청등급승인</option>
												<option>4_2재신청등급미승인</option>
											</select>
										</label>
										<label>진행결과
											<select id="approvalCategory2" name="elderServiceApprovalCategory2">
												<option selected value="">진행결과 선택</option> 
												<option>1최초신청(진행중)</option> 
												<option>2재신청(진행중)</option>
												<option>3최초처리완료(결과완료)</option>
												<option>4재신청처리완료(결과완료)</option>
											</select>
										</label>
										
									</div>
										<label>유효기간
											<div style="margin:0px; display:inline; margin-left:50px;">
									          <label><input type="radio" class="yearCheck" name="levelTermYear" value="1" checked/><span>1년</span></label>
									          <label><input type="radio" class="yearCheck" name="levelTermYear" value="2" /><span>2년</span></label>
									          <label><input type="radio" class="yearCheck" name="levelTermYear" value="3" /><span>3년</span></label>
									          <label><input type="radio" class="yearCheck" name="levelTermYear" value="4" /><span>4년</span></label>
									        </div>
									        <div>
											<input class="date" name="elderServiceApprovalStartDate" id="elderServiceApprovalStartDate">~<input class="date" name="elderServiceApprovalEndDate" id="elderServiceApprovalEndDate">
											</div>
										</label>
									<button type="button" class="btn btn-primary btn-xs" style="margin: 0 auto;" id="levelInsert" >등록하기</button>
									<button class="btn btn-metis-3 btn-xs" type="button" style="display: none" id="levelUpdate">수정하기</button>
									<button class="btn btn-metis-1 btn-xs" type="button" style="display: none" id="levelCancel">취소</button>
									</div>
								</div>
								<input type="hidden" id="elderCodeInLevel" name="elderLevelHistoryCode">
								<input type="hidden" id="elderIdInLevel" name="elderId">
								<input type="hidden" id="elderNameInLevel" name="elderName">
								</form>
							</div>
						</div>
			      </div>
			      <div class="modal-footer">
		        	<button type="button" class="btn btn-default" data-dismiss="modal">닫기</button>
			        <!-- <button type="button" class="btn btn-primary">Save changes</button> -->
			      </div>
			    </div>
			  </div>
			</div>
			<!-- 등급관리 model End -->
			<!-- 상태변경 및 관리내역 기록 Modal -->
			<div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="false" >
			  <div class="modal-dialog modal-lg" style="position: absolute; margin-top: 200px; margin-left: 300px;" >
			    <div class="modal-content">
			      <div class="modal-header">
			        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			        <h1 class="modal-title" id="myModalLabel">상태변경 및 관리내역 기록</h1>
			      </div>
			      <div class="modal-body">
						<div class="row">
							<div id="collapse4" class="col-sm-12">
								<table class="table table-bordered table-condensed table-hover table-striped modal-able">
									<thead>
										<tr>
											<th>번호</th>
											<th>낙상위험측정</th>
											<th>욕창위험측정</th>
											<th>인지기능검사</th>
											<th>욕구사정</th>
										</tr>
									</thead>
									<tbody style="cursor: pointer;">
									</tbody>
								</table>
							</div>
						</div>
						<h3>이력 등록/수정</h3>
						<div class="row" >
							<div class="col-sm-12" >
								<table class="table">
									<tr>
										<th>관리일 체크</th>
										<td>
										<label style="margin-right:10px;"><input type="checkbox" value="낙상위험">낙상위험측정</label>
										<label style="margin-right:10px;"><input type="checkbox" value="욕창위험측정">욕창위험측정</label>
										<label style="margin-right:10px;"><input type="checkbox" value="인지기능검사">인지기능검사</label>
										<label style="margin-right:10px;"><input type="checkbox" value="욕구사정">욕구사정</label>
										</td>
										<td></td>
									</tr>
									<tr>
										<th>날짜</th>
										<td><input class="date"><button class="btn btn-metis-5 btn-xs" style="text-align: right; margin-left: 10px;" >등록하기/수정하기</button></td>
									</tr>
								</table>
									
							</div>
						</div>
			      </div>
			      <div class="modal-footer">
		        	<button type="button" class="btn btn-default" data-dismiss="modal">닫기</button>
			        <!-- <button type="button" class="btn btn-primary">Save changes</button> -->
			      </div>
			    </div>
			  </div>
			</div>
			<!-- 등급관리 modal End -->
			<!-- 계약관리 Modal start -->
			<div class="modal fade" id="myModal3" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="false" style="position: absolute; padding-top: 200px">
			  <div class="modal-dialog modal-lg" style="position: absolute; margin-top: 300px; margin-left: 300px;">
			    <div class="modal-content">
			      <div class="modal-header">
			        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			        <h1 class="modal-title" id="myModalLabel">계약관리</h1>
			      </div>
			      <div class="modal-body">
			      	<h3>계약이력</h3>
						<div class="row">
							<div id="collapse4" class="col-sm-12">
								<table class="table table-bordered table-condensed table-hover table-striped modal-able">
									<thead>
										<tr>
											<th>상태구분</th>
											<th>계약일</th>
											<th>계약기간</th>
											<th>삭제</th>
										</tr>
									</thead>
									<tbody id="elderStatus">
									</tbody>
								</table>
							</div>
						</div>
						<h3>계약 등록/계약이력 수정</h3>
						<div class="row">
							<div class="col-sm-12" >
								<!-- <form action="#" method="post" class="roundBox"> -->
								<div class="form-group" style="background-color: #CCCCCC; border-radius: 2px; padding: 10px;" >
	 									<div id="elderStatusDiv">
										<label>수급상태
											<select id="elderStatusSelect" name="serviceStatus">
												<option value="">=수급상태=</option>
												<option value="수급">수급</option>
												<option value="보류">보류</option>
												<option value="해지">해지</option>
												<option value="사망">사망</option>
												<option value="타기관">타기관</option>
											</select>
										</label>
												<div>
													<label>계약기간
														<div style="margin: 0px; display: inline; margin-left: 50px;">
															<label><input type="radio" name="serviceTermYear" value="1" checked=""><span>1년</span></label>
															<label><input type="radio" name="serviceTermYear" value="2"><span>2년</span></label><label>
															<input type="radio" name="serviceTermYear" value="3"><span>3년</span></label><label>
															<input type="radio" name="serviceTermYear" value="4"><span>4년</span></label>
														</div>
														<div>
															<input class="date" name="serviceStartDate">~<input class="date" name="serviceEndDate">
														</div>
													</label>
												<button  class="btn btn-primary btn-xs" style="margin: 0 auto;" id="statusInsert">등록하기</button>
												<button class="btn btn-metis-3 btn-xs" type="button" style="display: none" id="statusUpdate">수정하기</button>
												<button class="btn btn-metis-1 btn-xs" type="button" style="display: none" id="statusCancel">취소</button>
												</div>
											</div>
								</div>
								<!-- </form> -->
							</div>
						</div>
			      </div>
			      <div class="modal-footer">
		        	<button type="button" class="btn btn-default" data-dismiss="modal">닫기</button>
			        <!-- <button type="button" class="btn btn-primary">Save changes</button> -->
			      </div>
			    </div>
			  </div>
			</div>
			<!-- 계약관리 modal End -->
		</div>
	</div>
</body>
</th:block>
<th:block layout:fragment="customPlugin">

            <!-- jQuery 기본 js파일 -->
            <script src="/assets/lib/jquery/jquery.js"></script>
            <!--Bootstrap -->
            <script src="/assets/lib/bootstrap/js/bootstrap.js"></script>
            <!-- MetisMenu -->
            <script src="/assets/lib/metismenu/metisMenu.js"></script>
            <!-- onoffcanvas -->
            <script src="/assets/lib/onoffcanvas/onoffcanvas.js"></script>
            <!-- Screenfull -->
            <script src="/assets/lib/screenfull/screenfull.js"></script>
            <!-- Metis core scripts -->
            <script src="/assets/js/core.js"></script>
            <!-- 날짜 입력때문에 추가한거. -->
            <link rel="stylesheet" href="/assets/lib/jquery/jquery-ui.min.css" type="text/css" />
			<script src="/assets/lib/jquery/jquery.min.js"></script>
			<script src="/assets/lib/jquery/jquery-ui.min.js"></script>
			<!-- 날짜 입력때문에 추가한거. -->
            <!-- 테이블 js -->
		    <script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.12/js/jquery.dataTables.min.js"></script>
		    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.26.6/js/jquery.tablesorter.min.js"></script>
		    <script src="/assets/lib/jquery/jquery.ui.touch-punch.min.js"></script>
		    <!-- 테이블 js -->
			<script src="/assets/lib/jquery/datepicker-ko.js"></script>
		  
<script>
    
    /* 수정화면 뿌릴때 버튼 수정버튼 생기기 */
    var changeBtn = function(updateBtn,insertBtn,cancelBtn){
		    	console.log(updateBtn)
		    	console.log(insertBtn)
		    	console.log(cancelBtn)
				$(updateBtn).show();
				$(insertBtn).hide();
				$(cancelBtn).show();
				$(cancelBtn).click(function(){
					$(insertBtn).show();
					$(updateBtn).hide();
					$(cancelBtn).hide();


				})
    }
    
   	/* 오늘 날짜 구하기 */
    var getToday = function(){
	    var today = new Date();
    	var dd = today.getDate();
    	var mm = today.getMonth()+1;
    	var yyyy = today.getFullYear();
    	if(dd<10) {
    	    dd='0'+dd
    	} 

    	if(mm<10) {
    	    mm='0'+mm
    	} 
    	return yyyy+"-"+mm+"-"+dd;
    }
    
	  /* 체크박스 체크된 년도로 날짜 계산하기 */
	  var changeDate = function(startDate,endDate,inputName){
			var levelStartDate = startDate;
			var levelLastDate = endDate;

  	  inputName.change(function(){
  		  if(levelStartDate.val() == null || levelStartDate.val() ==""){
  				levelStartDate.val(getToday());
				var year = levelStartDate.val().substring(0,4)
				var monthToDay = levelStartDate.val().substring(4)
				var yearInt = parseInt(year)
				var checkedInt = parseInt($(this).val())
				levelLastDate.val((yearInt+checkedInt)+monthToDay)
				}else{
					var year = levelStartDate.val().substring(0,4)
					var monthToDay = levelStartDate.val().substring(4)
					var yearInt = parseInt(year)
					var checkedInt = parseInt($(this).val())
					levelLastDate.val((yearInt+checkedInt)+monthToDay)
				}
		});
	  	startDate.change(function(){
			var levelStartDate = startDate;
			var levelLastDate = endDate;
	  		var year = levelStartDate.val().substring(0,4)
			var monthToDay = levelStartDate.val().substring(4)
			var yearInt = parseInt(year)
			var checkedInt = parseInt($(inputName).val())
			levelLastDate.val((yearInt+checkedInt)+monthToDay)
	  	})
	  }
    
    /* 계약 상태가 바뀔때 input 박스와 버튼이 바뀌는 이벤트 */
    var elderStatusEvent = function(value){
			var supplyHtml = '';
			supplyHtml += '<div><label>계약기간<div style="margin:0px; display:inline; margin-left:50px;">';
			supplyHtml += '<label><input type="radio" name="serviceTermYear" value="1" checked><span>1년</span></label>';
			supplyHtml += '<label><input type="radio" name="serviceTermYear" value="2" ><span>2년</span></label>';
			supplyHtml += '<label><input type="radio" name="serviceTermYear" value="3" ><span>3년</span></label>';
			supplyHtml += '<label><input type="radio" name="serviceTermYear" value="4" ><span>4년</span></label></div>';
			supplyHtml += '<div><input class="date" name="serviceStartDate">~<input class="date" name="serviceEndDate"></div></label>';
			supplyHtml += '<button id="insertStatus" class="btn btn-primary btn-xs" style="margin: 0 auto;" >등록하기</button></div>';
			
			var cancelHtml = '';
			cancelHtml += '<div><label>적용날짜<input class="date" name="serviceStartDate"></label>'; 
			cancelHtml += '<button id="insertStatus" class="btn btn-primary btn-xs" style="margin: 0 auto;" >등록하기</button></div>';
			
			if(value==""){
				return false;
			}
			if(value=='사망'||value=='해지'||value=='타기관'){
				$('#elderStatusDiv').find('div').remove();
				$('#elderStatusDiv').append(cancelHtml)
				
			}else{
				$('#elderStatusDiv').find('div').remove();
				$('#elderStatusDiv').append(supplyHtml);
				changeDate($('input[name="serviceStartDate"]'), $('input[name="serviceEndDate"]'), $('input[name="serviceTermYear"]'));
			}
			 $( ".date" ).datepicker({
			  	});
			
    }
	
    
    /* 삭제 버튼 마우스 on이벤트 */
    var deleteBtn = function(rowClass,tdNum){
    	
	   	 $(rowClass).find(tdNum).mouseover(function(){
			 $(this).find('button').css('display','block')
			
		})
		$(rowClass).find(tdNum).mouseout(function(){
			 $(this).find('button').css('display','none')
			
		})
    }
    
    				
    
	  /* 유효성 검사 함수 */
	  var checkEmpty = function(id){
			$(id).siblings('span').remove();
		if($(id).val()==null || $(id).val()==""){
			$(id).focus();
			$(id).parent().append("<span style=\"color :red;\">입력해주세요.</span>");
			
			return false;
		}else{
			
			return true;
		}
	}
	  
	  /* 수급자 레벨 리스트 뿌리는 함수  */
	  var levelListInModal = function(id){
	  var map = {};
		var Id = $(id).val()
		map.elderId = Id;
		$.ajax({
		type 	: 	'POST',
		url		:	'/elderDetailList',
		async	:	'true',
		data	:	JSON.stringify(map),
		contentType	:	'application/json',
		success	:	function(data){
			$('#elderNameInLevel').val(data.elderOenList.elderName);
			$('#elderIdInLevel').val(data.elderOenList.elderId);
			//등급인정 모달에 리스트 뿌리기.
			$('#elderServiceLevel').empty();
			for(var i = 0;i<data.elderOneLevelHistory.length;i++){
				var elderLevelHistoryCode = data.elderOneLevelHistory[i].elderLevelHistoryCode;
				var elderServiceApprovalLevel = data.elderOneLevelHistory[i].elderServiceApprovalLevel;
				var elderServiceApprovalStartDate = data.elderOneLevelHistory[i].elderServiceApprovalStartDate;
				var elderServiceApprovalEndDate = data.elderOneLevelHistory[i].elderServiceApprovalEndDate;
				var elderServiceApprovalNumber = data.elderOneLevelHistory[i].elderServiceApprovalNumber;
				var elderServiceApprovalCategory = data.elderOneLevelHistory[i].elderServiceApprovalCategory;
				var elderServiceApprovalCategory2 = data.elderOneLevelHistory[i].elderServiceApprovalCategory2;
				$('#elderServiceLevel').append("<tr class=\"elderLevelRow\"><input type=\"hidden\" name=\"levelCode\" value=\""+elderLevelHistoryCode+"\"><td>"+elderServiceApprovalLevel+"</td><td>"+elderServiceApprovalStartDate+"</td><td>"+elderServiceApprovalEndDate+"</td><td>"+elderServiceApprovalNumber+"</td><td>"+elderServiceApprovalCategory2+"</td><td>"+elderServiceApprovalCategory+"</td>"
					+"<td style=\"align :center;\"><button type=\"button\" style=\"display: none;\" class=\"deleteBtn btn btn-danger btn-xs\">삭제</button></td></tr>");						
				
			}
		},error	:	function(error){
			console.log("error", error)
		}
    	})
		  
	  }
		
		
      $(document).ready(function(){
    	  
    	  /* 등급 및 인정기간 수정 */
    	  $('#levelUpdate').click(function(){
    		        $.ajax({
					type 	: 	'POST',
					url		:	'/employee/levelUpdate',
					data	:	$("#level").serialize(),
					traditional :true,
					success	:	function(data){
						alert("수정완료.")
						levelListInModal(elderIdInLevel)
						
							},

        			error	:	function(error){
					console.log("error", error)
						alert("수정실패.")
				}
         		})
    	  })
    	  
    	 	/* 등급 및 인정기간 입력 */
        	$('#levelInsert').click(function(){
        		if($('#elderIdInLevel').val()==""){
        			alert('수급자를 선택해주세요.')
        			return false;
        		}
        		if(checkEmpty(levelGrade)){
        		}else{
        			return false;
        		}
        		if(checkEmpty(approvalNumber)){
        		}else{
        			return false;
        		}
        		if(checkEmpty(approvalCategory)){
        		}else{
        			return false;
        		}
        		if(checkEmpty(approvalCategory2)){
        		}else{
        			return false;
        		}
        		if(checkEmpty(elderServiceApprovalStartDate)){
        		}else{
        			return false;
        		}
        		if(checkEmpty(elderServiceApprovalEndDate)){
        		}else{
        			return false;
        		}
        		
        		$.ajax({
					type 	: 	'POST',
					url		:	'/employee/levelInsert',
					data	:	$("#level").serialize(),
					traditional :true,
					success	:	function(data){
						alert("등록되었습니다.")
						levelListInModal(elderIdInLevel)
							},

        			error	:	function(error){
					console.log("error", error)
						alert("등록 안됬습니다.")
				}
         		})
         		
        	})
            	
    	
	  	/* 위에 메인 리스트를 누르면 해당 수급자 상세정보 가져오기 */
		$('#elderRow tr').click(function(){
			$('#defaultTable').css('display','block');
			var map = {};
			var Id = $(this).find('td:eq(0)').text()
			map.elderId = Id;
			
			 $.ajax({
				type 	: 	'POST',
				url		:	'/elderDetailList',
				async	:	'true',
				data	:	JSON.stringify(map),
				contentType	:	'application/json',
				success	:	function(data){
					
					
					/* 수급자 계약 상태 리스트  */
					var status = data.elderstatusList
					$('#elderStatus').empty();
					var elderStatusRowHtml = '';
					
					for(var i=0;i<status.length;i++){
						var serviceStatusCode = status[i].serviceStatusCode
						var elderId = status[i].elderId
						var statusSort = status[i].serviceStatus
						var serviceStartDate = status[i].serviceStartDate
						var serviceEndDate = status[i].serviceEndDate
						elderStatusRowHtml += '<tr class="elderStatusRow">';
						elderStatusRowHtml += '<input type="hidden" name='+serviceStatusCode+' value='+serviceStatusCode+'>';
						elderStatusRowHtml += '<td>'+statusSort+'</td><td>'+serviceStartDate+'</td>';
						elderStatusRowHtml += '<td>'+serviceEndDate+'</td>';
						elderStatusRowHtml += '<td><button type="button" style="display: none;" class="deleteBtn btn btn-danger btn-xs">삭제</button></td></tr>';
						$('#elderStatus').append(elderStatusRowHtml);	
					}
					
					/* 계약관리 내에 셀렉박스 바뀔때 인풋 박스 변경 */
					$('#elderStatusSelect').change(function(){
						elderStatusEvent($(this).val());
					})
					/* 계약관리 리스트 삭제 부분에 마우스 올리면 삭제 버튼 나타남. */ 
					deleteBtn('.elderStatusRow','td:eq(3)');
					
					
					
						var statusUpdate = $('#statusUpdate')
						var statusInsert = $('#statusInsert')
						var statusCancel = $('#statusCancel')
					/* 계약관리 리스트 눌루면 아래 수정 화면으로 바뀌고 값 뿌려주기 */
					$('.elderStatusRow').click(function(){
						var serviceStatusCode = $(this).find('input').val();
						var statusSort = $(this).find('td:eq(0)').text();
						var serviceStartDate = $(this).find('td:eq(1)').text();
						var serviceEndDate = $(this).find('td:eq(2)').text();
						$('#elderStatusSelect').val(statusSort);
						elderStatusEvent(statusSort);
						$('input[name="serviceStartDate"]').val(serviceStartDate)
						$('input[name="serviceEndDate"]').val(serviceEndDate)
						changeBtn(statusUpdate,statusInsert,statusCancel);
					})
					    
					
					
					//등급인정 모달에 리스트 뿌리기.
					$('#elderNameInLevel').val(data.elderOenList.elderName);
					$('#elderIdInLevel').val(data.elderOenList.elderId);
					$('#elderServiceLevel').empty();
					for(var i = 0;i<data.elderOneLevelHistory.length;i++){
						var elderLevelHistoryCode = data.elderOneLevelHistory[i].elderLevelHistoryCode;
						var elderServiceApprovalLevel = data.elderOneLevelHistory[i].elderServiceApprovalLevel;
						var elderServiceApprovalStartDate = data.elderOneLevelHistory[i].elderServiceApprovalStartDate;
						var elderServiceApprovalEndDate = data.elderOneLevelHistory[i].elderServiceApprovalEndDate;
						var elderServiceApprovalNumber = data.elderOneLevelHistory[i].elderServiceApprovalNumber;
						var elderServiceApprovalCategory = data.elderOneLevelHistory[i].elderServiceApprovalCategory;
						var elderServiceApprovalCategory2 = data.elderOneLevelHistory[i].elderServiceApprovalCategory2;
						$('#elderServiceLevel').append("<tr class=\"elderLevelRow\"><input type=\"hidden\" name=\"levelCode\" value=\""+elderLevelHistoryCode+"\"><td>"+elderServiceApprovalLevel+"</td><td>"+elderServiceApprovalStartDate+"</td><td>"+elderServiceApprovalEndDate+"</td><td>"+elderServiceApprovalNumber+"</td><td>"+elderServiceApprovalCategory2+"</td><td>"+elderServiceApprovalCategory+"</td>"
							+"<td style=\"align :center;\"><button type=\"button\" style=\"display: none;\" class=\"deleteBtn btn btn-danger btn-xs\">삭제</button></td></tr>");						
						
					}
					
					
					/* 수급자 등급 및 인정기간 수정 하기 위해 아래 화면에 뿌려주기-------------------------------------------- */
			   		$('.elderLevelRow').click(function(){
			   			$("#levelGrade").siblings('span').remove();
			   			var levelCode = $(this).find('input[name=levelCode]').val();
			   			
			   			var elderServiceApprovalLevelDetail = $(this).find('td:eq(0)').text();
			   			var elderServiceApprovalStartDateDetail = $(this).find('td:eq(1)').text();
			   			var elderServiceApprovalEndDateDetail = $(this).find('td:eq(2)').text();
			   			var elderServiceApprovalNumber = $(this).find('td:eq(3)').text();
			   			var elderServiceApprovalCategoryDetail = $(this).find('td:eq(4)').text();
			   			var elderServiceApprovalCategory2Detail = $(this).find('td:eq(5)').text();
			   			$('#elderCodeInLevel').val(levelCode);
			   			$('#levelGrade').val(elderServiceApprovalLevelDetail);
			   			$('#approvalNumber').val(elderServiceApprovalNumber)
			   			$('#elderServiceApprovalStartDate').val(elderServiceApprovalStartDateDetail);
			   			$('#elderServiceApprovalEndDate').val(elderServiceApprovalEndDateDetail);
			   			$('#approvalCategory').val(elderServiceApprovalCategoryDetail);
			   			$('#approvalCategory2').val(elderServiceApprovalCategory2Detail)
			   			
			   			changeBtn(levelUpdate,levelInsert,levelCancel);
			   			$('#levelCancel').click(function(){
							$('#levelGrade').val('');
							$('#approvalNumber').val('');
							$('#elderServiceApprovalStartDate').val('');
							$('#elderServiceApprovalEndDate').val('');
							$('#approvalCategory').val('진행결과 선택');
							$('#approvalCategory2').val('진행상태 선택');
			   				
			   			})
			   			

					})
					/* 수급자 등급 및 인정기간 수정 하기 위해 아래 화면에 뿌려주기-------------------------------------------- */
					
					/* 등급인정 관리 리스트 삭제 부분에 마우스 올리면 삭제 버튼 나타남 */
					deleteBtn('.elderLevelRow','td:eq(6)');
					
					//수급자 정규검사
					var	fallDownCheckDate = data.fallDownCheck.elderRegularCheckDoingDate;
					var bedsoreCheckDate = data.bedsoreCheck.elderRegularCheckDoingDate
					var functionCheckDate = data.functionCheck.elderRegularCheckDoingDate
					var needsCheckDate = data.needsCheck.elderRegularCheckDoingDate
					
					//수급자 수급 인정기간 
					var serviceEndDate = data.elderLastStatus.serviceEndDate;
					var serviceStartDate = data.elderFirstStatusDate.serviceStartDate;
					
					//수급자 등급 히스토리
					var elderServiceApprovalEndDate = data.elderLastLevel.elderServiceApprovalEndDate;
					var elderServiceApprovalStartDate = data.elderLastLevel.elderServiceApprovalStartDate;
					//수급자 상세정보 (모달 밖에).
					var elderId = data.elderOenList.elderId
					var elderName = data.elderOenList.elderName
					var elderBirthDate = data.elderOenList.elderBirthDate
					var elderGender = data.elderOenList.elderGender
					var elderFinalServiceApprovalLevel = data.elderOenList.elderFinalServiceApprovalLevel
					var elderFinalServiceStatus = data.elderOenList.elderFinalServiceStatus
					var elderDisease = data.elderOenList.elderDisease
					var elderCoinsurance = data.elderOenList.elderCoinsurance
					var totalVisits = data.elderOenList.totalVisits
					var totalServiceTime = data.elderOenList.totalServiceTime
					var serviceLocalmanageCode = data.elderOenList.serviceLocalmanageCode
					var serviceLocalmanageName = data.elderOenList.serviceLocalmanageName
					var longTermCareNumver = data.elderOenList.longTermCareNumver
					var longTermCareValidity = data.elderOenList.longTermCareValidity
					var elderPhone = data.elderOenList.elderPhone
					var elderAdressForStay = data.elderOenList.elderAdressForStay
					var elderAdressForPost = data.elderOenList.elderAdressForPost
					var elderRemarks = data.elderOenList.elderRemarks
					var elderGroups = data.elderOenList.elderGroups
					$('#elderId').text(elderId);
					$('#elderName').text(elderName);
					$('#elderGender').text(elderGender);
					$('#elderFinalServiceStatus').text(elderFinalServiceStatus);
					$('#elderBirthDate').text(elderBirthDate);
					$('#elderCoinsurance').text(elderCoinsurance+"%");
					$('#elderLevel').text(elderFinalServiceApprovalLevel+' 등급 / '+longTermCareNumver);
					$('#elderServiceApprovalDate').text(elderServiceApprovalStartDate+" ~ "+elderServiceApprovalEndDate);
					$('#serviceEndDate').text(serviceEndDate);
					$('#serviceStartDate').text(serviceStartDate);
					$('#elderPhone').text(elderPhone);
					$('#elderAdressForStay').text(elderAdressForStay);
					$('#elderAdressForPost').text(elderAdressForPost);
					$('#elderDisease').text(elderDisease);
					$('#elderRemarks').text(elderRemarks);
					$('#fallDownCheckDate').text(fallDownCheckDate);
					$('#bedsoreCheckDate').text(bedsoreCheckDate);
					$('#functionCheckDate').text(functionCheckDate);
					$('#needsCheckDate').text(needsCheckDate);
					
					 $( ".date" ).datepicker({
					  	});
					 
					/* 수급자 레벨 및 인정기간 삭제 */
					$('.deleteBtn').click(function(){
						if(confirm('정말 삭제 하시겠습니까?')){
							var map = {};
							var Code = $(this).parents('.elderLevelRow').find('input').val();
							map.levelCode = Code;
							$.ajax({
								type 	: 	'POST',
								url		:	'/employee/levelDelete',
								async	:	'true',
								data	:	JSON.stringify(map),
								contentType	:	'application/json',
								success	:	function(data){
									alert("삭제완료.")
									levelListInModal(elderIdInLevel)
										},
	
			      			error	:	function(error){
								console.log("error", error)
									alert("삭제실패.")
							}
			       		})
						}
						})
					
				},
				error	:	function(error){
					console.log("error", error)
				}
			})   
		})
    	  
    	  //data table
    	  $('#dataTable').DataTable({

              "language": 
                 {
                 "sInfo": " 총_TOTAL_건의 자료 중  _START_번부터~_END_번까지 ",
                 "lengthMenu": "_MENU_ 개씩 보기",
                 "search":         "검색:",
                 "paginate": {
                 "first":      "First",
                 "last":       "Last",
                 "next":       "다음",
                 "previous":   "이전"
                      }
              }           
           });
    	  
		  	
		  	
		$('#myModal').draggable();
		$('#myModal2').draggable();
		$('#myModal3').draggable();
				
		$('#myModal').on('show.bs.modal', function () {
			  console.log('hi')			  
		})
		$('#myModal').on('shown.bs.modal', function () {
			  console.log('hi')
			  
			})
		$('#myModal').on('hide.bs.modal', function () {
			  console.log('hi')
			  
			})
		$('#myModal').on('hidden.bs.modal', function () {
			  console.log('hi')
			  
			})
		$('#myModal').on('loaded.bs.modal', function () {
			  console.log('hi')
			  
		})
			
			/* datepicker 메서드 */
		 $( ".date" ).datepicker({});
    	  
    	  
    	  /* 1~4년 라디오 박스클릭 시 맞는 값으로 들어가기 */
    	  /* 등급관리내 */
    	  changeDate($('input[name="elderServiceApprovalStartDate"]'),$('input[name="elderServiceApprovalEndDate"]'),$('input[name="levelTermYear"]'))
    	  /* 계약관리내 */
    	  changeDate($('input[name="serviceStartDate"]'), $('input[name="serviceEndDate"]'), $('input[name="serviceTermYear"]'))
    	 
    	  
      });
   </script>
</th:block>
</html>