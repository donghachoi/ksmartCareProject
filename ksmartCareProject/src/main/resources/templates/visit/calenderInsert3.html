<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/default}">

<!-- 사용자css -->
<th:block layout:fragment="customCss">
   <link rel="stylesheet" href="/assets/lib/font-awesome/css/font-awesome.css">
   
    <link rel="stylesheet" href="/vendor/css/fullcalendar.min.css" />
    <link rel="stylesheet" href="/vendor/css/bootstrap.min.css">
    <link rel="stylesheet" href="/vendor/css/select2.min.css" />
    <link rel="stylesheet" href="/vendor/css/bootstrap-datetimepicker.min.css" />

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,500,600">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

    <link rel="stylesheet" href="/vendor/css/main.css">
	<link rel="stylesheet"
		href="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.12/css/dataTables.bootstrap.min.css">
		
			
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<!-- <script src="/vendor/js/visit.js"></script> -->
	<script th:inline="javascript">
		$(document).ready(function(){
			
			//수급자 총 금액과 잔액 가져옴 
			$('.eldername').on('click', function(){
				$('tr').remove('#remove2');
				var id = $(this).attr('data-elder-id');
				var cost = $(this).attr('max-cost');
				var cname = $(this).attr('cname');
					$.ajax({
						type : 'POST',
						url : '/employee/velderbenefitcost',
						data: {elder_id : id, maxcost : cost},
						dataType : 'json',
						success : function(data){
								
						    var jsonStr = JSON.stringify(data);
						    var ali = JSON.parse(jsonStr);
						    $('#maxCost').text(cost);
						    $('#cname').html("<b>"+cname+"</b>");
						    var yearcheck= ali[0].monthlyClaimGroupCode.split("-");
						    var year = yearcheck[0];
						    var month = yearcheck[1];
						    $('#syear').val(year).attr("selected", "selected");
						    $('#smonth').val(month).attr("selected", "selected");
						    $('input[name=elder_id]').val(id);
						    for(var i=0; i<Object.keys(ali).length; i++){ 
						    	var str = '<tr id="remove2"><td>'+ ali[i].visitServiceCategory+'</td>';
						    	str += '<td>'+ ali[i].visitPlanTime+'</td>';
						    	str += '<td>'+ ali[i].visitServiceTime+'</td>';
						    	str += '<td></td>';
						    	str += '<td></td>';
						    	str += '<td></td></tr>';
						    	$("#row1").after(str);
						    }
						    $('#syear').val(yearcheck[0]).attr("selected", "selected");
						    $('#smonth').val(yearcheck[1]).attr("selected", "selected");
						},
						error : function(error){
							console.log("error", error);
						}
				});
			});
			
			//직원 분류해서 보여줌
			$('.serviceMenu').on("click", function(){
				
				var empcategory = $(this).attr('empcategory');
				var empservice = $(this).attr('empservice');
				
				$.ajax({
					url: "/employee/vemployeecategory",
					data : { empcategory : empcategory},
					dateType: "json",
					type: "GET",
					success : function(data){
						$('#employeeId').find('option').remove();
						$('#serviceCategoryDetail').find('option').remove();
						$('.modal-title').text("방문"+ empservice);
						
						for(var i=0; i<data.length; i++){
							$('#employeeId').append("<option value=\'"+ data[i].employeeId + "\'>"
									+ data[i].employeeName +"</option>");
						   }
						
						if(empservice =='요양'){
							var test = "<option value=\'요양\'>인지활동</option>";
							test += "<option value=\'요양\'>가족케어</option>";
							test += "<option value=\'요양\'>치매가족휴가(0회)</option>";
							
							$('#serviceCategoryDetail').append(test);
						}
						if(empservice == '목욕'){
							var test = "<option value=\'차량이용(차량 내)\'>차량이용(차량 내)</option>";
								test += "<option value=\'차량이용(가정 내)\'>차량이용(가정 내)</option>";
								test += "<option value=\'차량미이용\'>차량미이용</option>";
								
							$('#serviceCategoryDetail').append(test);
						 }
						if(empservice == '간호'){
							$('#serviceCategoryDetail').parent().hide();
						}				
						$('input[name=visitServiceCategory]').val(empservice);
						$('input[name=elderId]').val($('#cname').text());
						$('input[name=cname]').val($('#cname').text());
					},
		            error:function(){
		                alert("ajax통신 실패!!!");
		            }
				});
			});
			
			//--직원 분류해서 보여줌
		})
	</script>		
</th:block>
		
<th:block layout:fragment="customContents">
	 <header class="head">
		<div class="main-bar">
			<h3>
				<i class="fa fa-calendar">&nbsp; 방문일정등록</i>
			</h3>
		</div>
	</header>
	<div class="outer">
		<div class="inner bg-light lter">
			<!--Begin Datatables-->
			<div class="row">
				<!--수급자 목록-->
				<div class="col-lg-6">
					<div class="box">
						<header>
							<div class="icons">
								<i class="fa fa-table"></i>
							</div>
							<h5>수급자 목록</h5>
						</header>
						<div id="collapse4" class="body">
							<table id="dataTable"
								class="table table-bordered table-condensed table-hover sortableTable">
								<thead>
									<tr>
										<th>상태</th>
										<th>이름</th>
										<th>등급</th>
										<th>질병구분</th>
										<th>수가한도</th>
									</tr>
								</thead>
								<tbody>
									<tr th:each="g: ${list}">
										<td th:text="${g.elderFinalServiceStatus}"></td>
										<td><a href="javascript:void(0)" class="eldername" th:data-elder-id="${g.elderId}" 
										th:max-cost="${g.benefitMaxCost}" th:cname="${g.elderName}">[[${g.elderName}]]</a></td>
										<td th:text="${g.elderFinalServiceApprovalLevel}"></td>
										<td th:text="${g.elderDisease}"></td>
										<td th:text="${g.benefitMaxCost}"></td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>
				<!--/수급자 목록-->

				<div class="col-lg-6">

					<!--수급자 제공급여 요약-->
					<div class="box">
						<header>
							<div class="icons">
								<i class="fa fa-table"></i>
							</div>
							<h5>수급자 제공급여 요약</h5>
						</header>

						<div id="collapse4" class="body">
								<!-- /.col-lg-6 -->
						  
							<div class="row form-group">
							 
								<div class="col-lg-5">
								<form th:action="@{/employee/velderbenefitcost}" method="post">
									<select name ="syear" class="autotab input-sm" id="syear">
										<option th:value="2020">2020</option>
										<option th:value="2019">2019</option>
										<option th:value="2018">2018</option>
									</select>
									<select name ="smonth" class="autotab input-sm" id="smonth">
									<th:block th:each="num: ${#numbers.sequence(1,12)}">
										<option th:value="${num}">[[${num}]]</option>
									</th:block>
									</select>
									<input type="hidden" name="elder_id">
									<button type="submit" class="btn btn-primary btn-sm">검색</button>
								</form>							
							    </div>
									<div style="align:right;">
										<span><b>이름:  </b></span>
										<span id="cname"></span>
									</div>								
								</div>

							<!-- /.row -->
							<!-- /.col-lg-6 -->

								<div id="collapse4" class="body">
									<table
										class="table table-bordered table-condensed table-hover table-striped">
										<thead>
											<tr>
												<th colspan="2">급여한도</th>
												<th id="maxCost"></th>
												<th colspan="2">급여 잔액</th>
												<th id="mixCost"> </th>
											</tr>
										</thead>
										<tbody>
											<tr id="row1">
												<td>구분</td>
												<td>횟수</td>
												<td>총시간</td>
												<td>급여계</td>
												<td>본인부담</td>
												<td>비급여+초과</td>
											</tr>
											<tr>
												<td>계</td>
												<td></td>
												<td></td>
												<td></td>
												<td></td>
												<td></td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</div>
							<!--/수급자 제공급여 요약-->
					</div>
			</div>
			<!-- /.row -->
			<!--End Datatables-->

			<!--방문등록  -->

	        <!-- 일자 클릭시 메뉴오픈 -->
	        <div id="contextMenu" class="dropdown clearfix">
	            <ul class="dropdown-menu dropNewEvent" role="menu" aria-labelledby="dropdownMenu"
	                style="display:block;position:static;margin-bottom:5px;">
	                <li><a tabindex="-1" href="javascript:void(0)" class="serviceMenu" th:empcategory="요양" th:empservice="요양">방문요양</a></li>
	                <li><a tabindex="-1" href="javascript:void(0)" class="serviceMenu" th:empcategory="요양" th:empservice="목욕">방문목욕</a></li>
	                <li><a tabindex="-1" href="javascript:void(0)" class="serviceMenu" th:empcategory="간호" th:empservice="간호">방문간호</a></li>
	                <li class="divider"></li>
	                <li><a tabindex="-1" href="#" data-role="close">Close</a></li>
	            </ul>
	        </div>
	
	        <div id="wrapper">
	            <div id="loading"></div>
	            <div id="calendar"></div>
	        </div>
	
			<!-- 일정 등록 폼 -->
	        <!-- 일정 추가 MODAL -->
	        <div class="modal fade" tabindex="-1" role="dialog" id="eventModal">
	            <div class="modal-dialog" role="document">
	                <div class="modal-content">
	                    <div class="modal-header">
	                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
	                                aria-hidden="true">&times;</span></button>
	                        <h4 class="modal-title"></h4>
	                        <input type="hidden" name="visitServiceCategory"/>
	                        <input type="hidden" name="elderId" />
	                        <input type="hidden" name="cname" />
	                    </div>
	                    <div class="modal-body"> 
	                        <div class="row">
	                            <div class="col-xs-12">
	                                <label class="col-xs-4" for="edit-allDay">비급여 체크</label>
	                                <input class='allDayNewEvent' id="yoyangBathNonBenefit" type="checkbox" name="yoyangBathNonBenefit" />
	                            </div>
	                        </div>
	
	                        <div class="row">
	                            <div class="col-xs-12">
	                                <label class="col-xs-4" for="edit-title">요양사 선택</label>
	                                <select class="inputModal" name="employeeId" id="employeeId"></select>

	                            </div>
	                        </div>
	                        <div class="row">
	                            <div class="col-xs-12">
	                                <label class="col-xs-4" for="edit-start">시작</label>
	                                <input class="inputModal" type="text" name="visitPlanDate" id="edit-start" />
	                            </div>
	                        </div>
	                        <div class="row">
	                            <div class="col-xs-12">
	                                <label class="col-xs-4" for="edit-end">끝</label>
	                                <input class="inputModal" type="text" name="visitPlanTime" id="edit-end" />
	                            </div>
	                        </div>
	                        <div class="row">
	                            <div class="col-xs-12">
	                                <label class="col-xs-4" for="edit-type">구분</label>
	                                <select class="inputModal" name="serviceCategoryDetail" id="serviceCategoryDetail">               
	                                </select>
	                            </div>
	                        </div>
	                        <div class="row">
	                            <div class="col-xs-12">
	                                <label class="col-xs-4" for="edit-color">색상</label>
	                                <select class="inputModal" name="backgroundColor" id="edit_color">
	                                    <option value="#D25565" style="color:#D25565;">빨간색</option>
	                                    <option value="#9775fa" style="color:#9775fa;">보라색</option>
	                                    <option value="#ffa94d" style="color:#ffa94d;">주황색</option>
	                                    <option value="#74c0fc" style="color:#74c0fc;">파란색</option>
	                                    <option value="#f06595" style="color:#f06595;">핑크색</option>
	                                    <option value="#63e6be" style="color:#63e6be;">연두색</option>
	                                    <option value="#a9e34b" style="color:#a9e34b;">초록색</option>
	                                    <option value="#4d638c" style="color:#4d638c;">남색</option>
	                                    <option value="#495057" style="color:#495057;">검정색</option>
	                                </select>
	                            </div>
	                        </div>
	                        <div class="row">
	                            <div class="col-xs-12">
	                                <label class="col-xs-4" for="description">비고</label>
	                                <textarea rows="4" cols="50" class="inputModal" name="edit-desc"
	                                    id="edit-desc"></textarea>
	                            </div>
	                        </div>
	                    </div>
	                    <div class="modal-footer modalBtnContainer-addEvent">
	                        <button type="button" class="btn btn-default" data-dismiss="modal">취소</button>
	                        <button type="button" class="btn btn-primary" id="save-event">저장</button>
	                    </div>
	                    <div class="modal-footer modalBtnContainer-modifyEvent">
	                        <button type="button" class="btn btn-default" data-dismiss="modal">닫기</button>
	                        <button type="button" class="btn btn-danger" id="deleteEvent">삭제</button>
	                        <button type="button" class="btn btn-primary" id="updateEvent">저장</button>
	                    </div>
	                </div><!-- /.modal-content -->
	            </div><!-- /.modal-dialog -->
	        </div><!-- /.modal -->
			<!-- /일정 등록 폼 -->
 		</div>
	        <div class="panel panel-default">
	
	            <div class="panel-heading"  >
	                <h3 class="panel-title">  ㅇ</h3>
	            </div>

	        </div>
	        <!-- /.filter panel -->
	    </div>
	    <!-- /.container -->

		<!-- /방문등록  -->

	<!-- /.outer -->
</th:block>

<th:block layout:fragment="customPlugin">
	<!--jQuery -->
<!-- 	<script src="/assets/lib/jque/ry/jq/uery.js"></script> -->
	
	<!-- Tables -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.0/jquery-ui.min.js"></script>
	<script src="/assets/js/jquery.dataTables.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.12/js/dataTables.bootstrap.min.js"></script>
	
	<!-- 움직임 관련  -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.26.6/js/jquery.tablesorter.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>

	<!-- 캘린더 -->
<!--      <script src="/vendor/js/jquery.min.js"></script>  //Search 안나옴 -->
    <script src="/vendor/js/bootstrap.min.js"></script>
    <script src="/vendor/js/moment.min.js"></script>
    <script src="/vendor/js/fullcalendar.min.js"></script>
    <script src="/vendor/js/ko.js"></script>
    <script src="/vendor/js/select2.min.js"></script>
    <script src="/vendor/js/bootstrap-datetimepicker.min.js"></script>
    <script src="/vendor/js/main.js"></script>
    <script src="/vendor/js/addEvent.js"></script>
    <script src="/vendor/js/editEvent.js"></script>
    <script src="/vendor/js/etcSetting.js"></script>

	<!--Bootstrap -->
	<script src="/assets/lib/bootstrap/js/bootstrap.js"></script>
	<!-- MetisMenu -->
	<script src="/assets/lib/metismenu/metisMenu.js"></script>
	<!-- onoffcanvas -->
	<script src="/assets/lib/onoffcanvas/onoffcanvas.js"></script>
	<!-- Screenfull -->
	<script src="/assets/lib/screenfull/screenfull.js"></script>

	<!-- Metis core scripts -->
	<script src="/assets/js/core.js"></script>
	<!-- Metis demo scripts -->
	<script src="/assets/js/app.js"></script>

	<script>
		$(function() {
			//Metis.MetisCalendar();
			Metis.MetisTable();
			//Metis.metisSortable();
		});
	</script>
	<script src="/assets/js/style-switcher.js"></script>
</th:block>
</html>